<!DOCTYPE html>
<html lang="en">
  <head>
    <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    name="viewport"
  />
  <title>Drowning me></title>
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

  </head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Drowning me</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
      <li class="menu-item">
        <a href="/" class="menu-item-link"
          >home</a
        >
      </li>
      
      <li class="menu-item">
        <a href="/categories" class="menu-item-link"
          >categories</a
        >
      </li>
      
      <li class="menu-item">
        <a href="/tags" class="menu-item-link"
          >tags</a
        >
      </li>
      
      <li class="menu-item">
        <a href="/archives" class="menu-item-link"
          >archives</a
        >
      </li>
      
      <li class="menu-item">
        <a href="/about" class="menu-item-link"
          >about</a
        >
      </li>
      
    </ul>
  </nav>
</header>
 <article class="post">
    <div class="post-title">
        <h2 class="title">ProjectASocialNewsWebPageapp</h2>
    </div>
    <div class="post-meta">
        <span class="post-time">2018-12-17</span>
    </div>
    <div class="post-content">
        <p>2018.12.17 11:07 <strong>ES6学习中</strong></p>
<blockquote>
<p>Thejsway/chapter26 <code>&lt;Project: a social news web app&gt;</code></p>
</blockquote>
<p>原题:</p>
<h1 id="Project-a-social-news-web-app"><a href="#Project-a-social-news-web-app" class="headerlink" title="Project: a social news web app"></a>Project: a social news web app</h1><p>This final project is the culmination of the book. You can check out the <a href="https://thejsway-publink.herokuapp.com" target="_blank" rel="noopener">expected result</a>. Good luck!</p>
<a id="more"></a>

<h2 id="Objective"><a href="#Objective" class="headerlink" title="Objective"></a>Objective</h2><p>This project builds upon the social news program and web pages you created previously. This time, the objective is to make a social news application based on a Node.js server.</p>
<h2 id="Functional-requirements"><a href="#Functional-requirements" class="headerlink" title="Functional requirements"></a>Functional requirements</h2><ul>
<li>A link is defined by its title, its URL and its author (submitter).</li>
<li>If a new link URL does not start with “http://“ or “https://“, “http://“ is automatically added at its beginning.</li>
<li>The web app displays a list of at least three already existing links, fetched from the server through an AJAX request.</li>
<li>A button exists for the user to submit a new link. When clicked, a form appears before the link list to input the new link properties (author, title and URL).</li>
<li>In this form, all link fields are mandatory.</li>
<li>When the new link is validated by the user, it is sent as form data to the server. If the operation is successful, the server returns the new link as JSON data. The new link is added at the top of the link list, replacing the form. A message indicates the success of the operation, then disappears after two seconds.</li>
</ul>
<h2 id="Technical-requirements"><a href="#Technical-requirements" class="headerlink" title="Technical requirements"></a>Technical requirements</h2><ul>
<li>The server must use a user-defined module exporting link-related code.</li>
<li>You should reuse any useful code from the previous projects.</li>
<li>All your code should be correctly indented.</li>
<li>Names should be wisely chosen and adhere to the camelCase convention.</li>
<li>Code duplication should be avoided.</li>
</ul>
<h2 id="Expected-result"><a href="#Expected-result" class="headerlink" title="Expected result"></a>Expected result</h2><p>Here are a few screenshots of the expected result.</p>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013192921261.png" alt="image-20201013192921261"></p>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013192927246.png" alt="image-20201013192927246"></p>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013192932469.png" alt="image-20201013192932469"></p>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013192937932.png" alt="image-20201013192937932"></p>
<p>=。=决定认真的写一下过程</p>
<h3 id="1-将页面更改为服务端。"><a href="#1-将页面更改为服务端。" class="headerlink" title="1.将页面更改为服务端。"></a>1.将页面更改为服务端。</h3><p>将 <code>fitst.html</code> <code>eample.js</code> <code>first.css</code> 以及部分需求的 <code>js</code> 或者 <code>css</code> 文件复制到 <code>myserver</code>  文件夹中。</p>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013193413251.png" alt="image-20201013193413251"></p>
<pre class=" language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/first'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/views/first.html`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>添加一个 <code>app.get</code> 来使 <code>localhost:3000/first</code> 展示为 <code>first.html</code> 。</p>
<p>百般尝试发现无法实现初始化三个链接，一番操作后发现自己打开了另一个路径的 <code>example.js</code>（???修改后发现传入函数 <code>createmenu(link)</code> 的 <code>link</code> 为 <code>undefined</code> 并且只出现了一个链接框(??? 控制台输出大法后发现传入的 <code>link</code> 为 <code>Array(3)</code> (??? 说好的 <code>JSON</code> 呢???)于是循环遍历后，便达成了效果。</p>
<pre class=" language-js"><code class="language-js"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/api/first'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> one <span class="token keyword">of</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">createmenu</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/api/first'</span><span class="token punctuation">,</span> jsonParser<span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>links<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/first'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/views/first.html`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013193423479.png" alt="image-20201013193423479"></p>
<p>爱心为啥变成了问号，我也母鸡。</p>
<p>又在 <code>JSON</code> 的类型上纠结了很久。</p>
<pre class=" language-js"><code class="language-js">linkform<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> e <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/api/first'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> formData
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">createsucceed</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/ai/first'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">)</span> <span class="token operator">||</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'https://'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>input <span class="token operator">=</span> <span class="token string">'http://'</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>input<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>题目要求为作为表单数据发送给服务器，而服务器以 <code>JSON</code> 数据的形式返回新链接。<br>经过数次尝试后发现在服务器以 <code>JSON.stringify</code> 方法的返回类型返回的话, 再转换为 <code>text</code> 即可达成效果。(但是成功时的提示消息的样式信息怎么给我搞丢了….)</p>
<p><img src="/2018/12/17/projectasocialnewswebpageapp/image-20201013193431327.png" alt="image-20201013193431327"></p>
<p>新的数据怎么又成 <code>undefined</code> 的了。<br>路径的 <code>api</code> 少了一个 <code>p</code> 真好。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> createlink <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> linkform <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  linkform<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'linkForm'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input4 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input1<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'250px'</span><span class="token punctuation">;</span>
  input2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'450px'</span><span class="token punctuation">;</span>
  input3<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'300px'</span><span class="token punctuation">;</span>
  input4<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'100px'</span><span class="token punctuation">;</span>
  input1<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span>
  input1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'title'</span><span class="token punctuation">;</span>
  input2<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span>
  input2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'url'</span><span class="token punctuation">;</span>
  input3<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span>
  input3<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'submitted'</span><span class="token punctuation">;</span>
  input4<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'submit'</span><span class="token punctuation">;</span>
  input1<span class="token punctuation">.</span>required <span class="token operator">=</span> <span class="token string">'required'</span><span class="token punctuation">;</span>
  input2<span class="token punctuation">.</span>required <span class="token operator">=</span> <span class="token string">'required'</span><span class="token punctuation">;</span>
  input3<span class="token punctuation">.</span>required <span class="token operator">=</span> <span class="token string">'required'</span><span class="token punctuation">;</span>
  input4<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'inputbutton'</span><span class="token punctuation">;</span>
  input4<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Add link'</span><span class="token punctuation">;</span>
  linkform<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> e <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/api/first'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> formData
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createsucceed</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  linkform<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  linkform<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  linkform<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  linkform<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document
    <span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>linkform<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/first'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">)</span> <span class="token operator">||</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'https://'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">'http://'</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
  <span class="token keyword">const</span> res3 <span class="token operator">=</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>submitted<span class="token punctuation">;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> res1<span class="token punctuation">,</span>
    url<span class="token punctuation">:</span> res2<span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> res3
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>疯狂的控制台输出大法后发现, 传到客户端的应该是 <code>JSON</code> 对象而不是字符串 所以改为 <code>response.json()</code> 然后就基本达成效果。<br>大致完工。绿色的样式信息懒得写了=。=</p>

    </div>
</article>
 <footer>
  <p>
    Theme is <a href="/" target="_blank">Theme-example</a> by
    <a href="https://s1rine.github.io" target="_blank">Sirine</a>
  </p>
  <p>
    Powered by
    <a href="https://hexo.io/" target="_blank" rel="nofollow">hexo</a>
    &copy; 2021
  </p>
</footer>

    </div>
  </body>
</html>
